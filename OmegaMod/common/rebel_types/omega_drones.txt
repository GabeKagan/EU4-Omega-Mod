# Omega drones.
# The lore here is that the Omega will send undercover agents into countries they're at war with to kidnap citizens and assimilate them into the Omegan hive mind.
# When they win a siege, they change the culture of the province to the new Omegan culture; the Omega also gets cores on them.
# If they can enforce their demands, the entire country is annexed by the Omega. This is definitely cruel, and I might adjust this down if I feel it necessary.
# Currently, they can spawn by debug event, but they will not appear naturally.
# Furthermore, the game crashes when I attempt to enter the negotiation screen, or when a drone sieges a province.

omega_drones = {
    area = nation
    government = any
    defection = yes
    defect_delay = 24 #This will cause border gore, but it's worth a try.
    independence = none
    gfx_type = culture_owner

    resilient = yes #Oh, they're nasty.
    reinforcing = yes
    general = yes
    smart = yes
    disband_on_leader_death = no 
    will_relocate = yes 

    artillery = 0.1
    infantry = 0.6
    cavalry = 0.3

    morale = 1.2

    # Possible handle actions
    handle_action_negotiate = no
    handle_action_stability = yes
    handle_action_build_core = yes
    handle_action_send_missionary = yes 

    #Omega drones should only spawn on normal or higher difficulty, and only for countries at war with the Omega.
    #However, when they can spawn, they should spawn exclusively.
    spawn_chance = {
        factor = 999
        modifier = {
            factor = 0
            has_global_flag = no_drone_rebels
        }
        modifier = {
            factor = 0
            owner = OME #Pretty sure the Omega can keep drones in its territory under control...
        }
        modifier = {
            factor = 0
            NOT = { 
                owner = { war_with = OME } 
            }
        }
    }

    # This is checked for EACH province in the Area of Operations
    # Maybe more complicated movement logic later?
    movement_evaluation = {
        factor = 1
        modifier = {
            factor = 0.001
            controlled_by = REB
        }
        modifier = {
            factor = 0
            owner = OME #Drone rebels will not move into Omegan territory.
        }
    }

    # Province Scope
    siege_won_trigger = {
        always = yes #Only for the sake of having something here
    }
    siege_won_effect = {
        #change_culture = omegan #Apparently, you can't change culture on rebel sieges.
        add_core = OME
        #Possibly try to spawn another rebel stack every time these guys win?
        spawn_rebels = {
            type = omega_drones
            size = 5
        }
    }

    # Country scope
    can_negotiate_trigger = {
        always = no
    }
    
    # Country scope
    can_enforce_trigger = {
        always = yes
    }

    # Localisation for their demands; see templates in text_l_english.yml
    demands_description = "omega_drones_demand" 

    # Country Scope 
    demands_enforced_effect = {
        add_prestige = -200
        every_owned_province = {
        #    limit = {
        #        has_rebel_faction = REB
        #    }
            add_core = OME
            cede_province = OME
        }
    }
}